---
title: "Creating a Computer Vision court detector"
categories:
- "Computer Vision"

gallery:
- url: assets/images/cv/courts/court_1.jpg
  image_path: assets/images/cv/courts/court_1.jpg
  alt: "Dataset 1"
- url: assets/images/cv/courts/court_2.jpg
  image_path: assets/images/cv/courts/court_2.jpg
  alt: "Dataset 2"
- url: assets/images/cv/courts/court_3.jpg
  image_path: assets/images/cv/courts/court_3.jpg
  alt: "Dataset 3"
- url: assets/images/cv/courts/court_4.jpg
  image_path: assets/images/cv/courts/court_4.jpg
  alt: "Dataset 4"
---

As a project for the Image Processing and Computer Vision course, I decided to replicate the content of a paper, [Court Reconstruction for Camera Calibration
in Broadcast Basketball Videos](/assets/pdfs/court_dection.pdf), by Wen et al.

The goal of the paper is to track basketball players' position from broadcast footage. This subject has been covered vastly in the Computer Vision field, but the approach of the authors is much robuster and automatized than all previous methods.

Traditional methods are either based on key features detection or on user-input. The former requires the identification of key features in the frame, such as court lines or corners. This approach nonetheless is not robust due to occlusions and noise. The latter, on the other hand, requires a human user to input the corners of the court in the first frame of the footage. This is not scalable, and therefore not desirable.

The approach presented in the paper is based on another algorithm: instead of using a single frame to determine the coordinates, the authors use a set of frames containing the whole court. 

By using [Kanade-Lucas-Tomasi](https://ieeexplore.ieee.org/document/323794) detector, the authors estimate homographies between consecutive frames transforming each frame to the same coordinate system, blending the pixels colors.

The next step requires detecting the court region, which is achieved using the dominant color in the image. Subsequently, the court is warped to a quadrangle to reduce transformation errors.

Finally, thanks to corner correspondence, the quadrangular court is rectified to a standard court using a homography to remove the perspective effect. This also allows to transform the players coordinates between the two systems.

The first step, i.e. finding homographies, is way more robust if it is performed on the court, ignoring noise, broadcasting graphics and players. Therefore, I will firstly deal with image segmentation, in order to create a mask where KLT will be applied.

Moreover, the check on court completeness, which is essential for the correct behavior of the algorithm, relies on court detection, which in turn relies on image segmentation, so I will dedicate plenty of time and explanation on this part of the software.

## Image segmentation

Differently from soccer or football fields, basketball courts are hardwood floors, which means that it is frequent to have stickers, and zones which have different colors. For instance, as the name suggests, 'the paint' is usually of a totally different color from the rest of the court, and in Europe is also frequent that the court has a different color inside and outside the 3 point line. This will be the case in 3 out of 4 of the used datasets.

In particular, the datasets feature one game from the Italian League (dataset 1), two from Euroleague (datasets 2 and 3) and one from NBA (dataset 4). While datasets 1 and 2 are very common courts, datasets 3 and 4 feature a case limit, due to the color of the court or to the court pattern.

{% include gallery layout="half" caption="" %}

The assumptions of the paper are simplistic, and holds only in the case where most of the court has the same color, which is rare.

Let's see how the strategy presented
